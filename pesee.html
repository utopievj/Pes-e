<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>PesÃ©e</title>

<!-- PWA -->
<link rel="manifest" href="/Pes-e/manifest.json">
<meta name="theme-color" content="#b22222">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:system-ui;background:#0b0c10;color:#e9eef6}
.wrap{max-width:980px;margin:auto;padding:16px}
.card{background:#12141b;border:1px solid #222634;border-radius:16px;padding:16px}
label{display:block;margin:8px 0 4px;font-size:12px;color:#a8b3d6}
input,select{width:100%;padding:12px;border-radius:12px;border:1px solid #262b3a;background:#0f1118;color:#fff;box-sizing:border-box}
button{padding:14px;border-radius:12px;border:1px solid #7a1f1f;background:#b22222;color:#fff;font-weight:800;cursor:pointer}
button:hover{background:#d32f2f}
.smallBtn{padding:10px 12px;font-size:12px}
.danger{background:#8b0000;border-color:#5c0000}
.grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
.col-4{grid-column:span 4}.col-3{grid-column:span 3}.col-2{grid-column:span 2}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
@media(max-width:820px){.col-4,.col-3,.col-2,.col-6{grid-column:span 12}}
.big{font-size:34px;font-weight:900;margin:8px 0}
.badge{display:inline-block;padding:4px 10px;border:1px solid #222634;border-radius:999px;font-size:12px;color:#a8b3d6}
.tableWrap{overflow:auto;border:1px solid #222634;border-radius:12px;margin-top:10px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #222634}
th{font-size:12px;color:#a8b3d6;white-space:nowrap;text-align:left}
.right{text-align:right}
.center{min-height:90vh;display:flex;align-items:center;justify-content:center}
.max420{max-width:420px;width:100%}
#status{margin:10px 0;font-size:12px;white-space:pre-wrap;color:#ffd27a}
.muted{color:#a8b3d6;font-size:12px}
hr{border:0;border-top:1px solid #222634;margin:14px 0}
.tag{display:inline-block;font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid #222634;color:#a8b3d6}
.tagOk{border-color:#1f6f3a;color:#a7f3c6}
.tagWait{border-color:#7a1f1f;color:#ffd27a}
.tagCache{border-color:#3a4a7a;color:#b7c6ff}

/* === CLEAN VISUEL : plus de bleu + pas de petites descriptions === */
label, th, .badge, .muted, .tag { color:#ffffff !important; }
.muted, .tag { display:none !important; }
#status { display:none !important; }
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" class="center">
  <div class="card max420">
    <h2 style="margin-top:0">Connexion</h2>

    <label>Email</label>
    <input id="email" type="email" autocomplete="username">

    <label>Mot de passe</label>
    <input id="password" type="password" autocomplete="current-password">

    <div style="margin-top:12px;display:grid;gap:10px">
      <button onclick="login()">SE CONNECTER</button>
    </div>

    <div id="loginMsg" style="margin-top:10px;font-size:12px;white-space:pre-wrap;color:#ffd27a"></div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <div class="wrap">
    <div class="card">

      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <button class="smallBtn" onclick="show('pesee')">PESÃ‰E</button>
        <button class="smallBtn" onclick="show('hist')">HISTORIQUE</button>
        <button class="smallBtn" onclick="show('trie')">TRIE</button>
        <button class="smallBtn" onclick="loadData()">ðŸ”„ RafraÃ®chir</button>
        <button class="smallBtn" onclick="syncPending()">âŸ³ SYNC (<span id="pendingCount">0</span>)</button>
        <button class="smallBtn" onclick="logout()">ðŸšª DÃ©connexion</button>
        <span class="badge" id="badgeUser">ConnectÃ©</span>
        <span class="badge" id="badgeNet">RÃ©seau : ?</span>
        <span class="badge" id="badgeAdmin">Utilisateur</span>
        <span class="badge" id="badgeStore">DonnÃ©es : ?</span>
      </div>

      <div id="status">PrÃªt.</div>

      <!-- PAGE PESÃ‰E -->
      <div id="pagePesee">
        <h2>PesÃ©e</h2>

        <div class="grid">
          <div class="col-4">
            <label>Ville</label>
            <select id="ville"></select>
          </div>

          <div class="col-4">
            <label>Type</label>
            <select id="type">
              <option value="PAM">PAM</option>
              <option value="ASL">ASL</option>
              <option value="ABJ">ABJ</option>
              <option value="FRIGO">Frigo</option>
              <option value="HF">Hors froid</option>
            </select>
          </div>

          <div class="col-2">
            <label>Nb</label>
            <select id="nb"><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>

          <div class="col-2">
            <label>Brut (kg)</label>
            <input id="brut" type="number" step="0.1" placeholder="Ex: 120.5">
          </div>

          <div class="col-12">
            <div class="big">Net : <span id="net">0</span> kg</div>
          </div>

          <div class="col-12">
            <button onclick="saveSafe()">ENREGISTRER</button>
          </div>
        </div>
      </div>

      <!-- PAGE TRIE (TOUJOURS +1 / -1) -->
      <div id="pageTrie" style="display:none">
        <h2>Trie</h2>

        <div class="grid">
          <div class="col-12" style="display:flex;gap:12px;flex-wrap:wrap">
            <button onclick="saveTrie(+1)">+ 1 PAM TRIÃ‰</button>
            <button class="danger" onclick="saveTrie(-1)">- 1 PAM TRIÃ‰</button>
          </div>

          <div class="col-12">
            <div class="badge">Chaque clic sâ€™enregistre et apparaÃ®t dans Historique â†’ Trie.</div>
          </div>
        </div>
      </div>

      <!-- PAGE HIST -->
      <div id="pageHist" style="display:none">
        <h2>Historique</h2>

        <h3>RÃ©cap du jour</h3>
        <div class="grid">
          <div class="col-4">
            <label>Date</label>
            <input id="recapDate" type="date">
          </div>
          <div class="col-2" style="display:flex;align-items:end;gap:8px;flex-wrap:wrap">
            <button class="smallBtn" onclick="recapToday()">Aujourdâ€™hui</button>
            <button class="smallBtn" onclick="buildRecap()">Afficher</button>
          </div>
        </div>

        <h4>Total (toutes villes)</h4>
        <div class="tableWrap">
          <table>
            <thead>
              <tr><th class="right">PAM</th><th class="right">ASL</th><th class="right">ABJ</th><th class="right">F</th><th class="right">HF</th><th class="right">TOTAL</th></tr>
            </thead>
            <tbody id="recapAll"></tbody>
          </table>
        </div>

        <h4 style="margin-top:14px">Par ville</h4>
        <div class="tableWrap">
          <table>
            <thead>
              <tr><th>Ville</th><th class="right">PAM</th><th class="right">ASL</th><th class="right">ABJ</th><th class="right">F</th><th class="right">HF</th><th class="right">TOTAL</th></tr>
            </thead>
            <tbody id="recapByCity"></tbody>
          </table>
        </div>

        <hr>

        <h3>En attente (hors-ligne)</h3>
        <div class="tableWrap">
          <table>
            <thead>
              <tr><th>Date</th><th>Ville</th><th>Type</th><th class="right">Nb</th><th class="right">Net</th><th class="right">Action</th></tr>
            </thead>
            <tbody id="pendingTable"></tbody>
          </table>
        </div>

        <hr>

        <h3>Historique â€“ PesÃ©es</h3>
        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Date</th><th>Ville</th><th>Type</th><th class="right">Nb</th><th class="right">Net</th><th>Source</th>
              </tr>
            </thead>
            <tbody id="histPesee"></tbody>
          </table>
        </div>

        <hr>

        <h3>Historique â€“ Trie (PAM triÃ©)</h3>
        <div class="badge">Total PAM triÃ© du jour : <b><span id="totalTrieJour">0</span></b></div>

        <div class="tableWrap" style="margin-top:10px">
          <table>
            <thead>
              <tr>
                <th>Date</th><th>Type</th><th class="right">Nb</th><th>Source</th>
              </tr>
            </thead>
            <tbody id="histTrie"></tbody>
          </table>
        </div>

      </div>

    </div>
  </div>
</div>

<script>
/* âœ… SUPABASE */
const supabase = window.supabase.createClient(
  "https://dzfokswsmkvhjhziqakj.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6Zm9rc3dzbWt2aGpoemlxYWtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTQ5MTAsImV4cCI6MjA4MTM5MDkxMH0.dVdAUGstXPPSAeDQwX-Paha2s86rebaSwnsk6hFYpq0"
);

/* TARES + TYPES */
const T = { PAM:59, ASL:45, ABJ:43, FRIGO:0, HF:0 };
const A = { PAM:"PAM", ASL:"ASL", ABJ:"ABJ", FRIGO:"F", HF:"HF" };
const TYPES = ["PAM","ASL","ABJ","F","HF"];

const PENDING_KEY = "pesees_pending_v4";
const HISTORY_CACHE_KEY = "pesees_history_cache_v1";
const CACHE_META_KEY = "pesees_history_cache_meta_v1";

const $ = (id)=>document.getElementById(id);
const r1 = (x)=>Math.round(x*10)/10;
const num = (x)=>{ const v=Number(String(x).replace(",", ".")); return Number.isFinite(v)?v:0; };

let lastHistorySource = "LIVE";

/* Pages */
function show(p){
  $("pagePesee").style.display = (p==="pesee") ? "block" : "none";
  $("pageHist").style.display  = (p==="hist")  ? "block" : "none";
  $("pageTrie").style.display  = (p==="trie")  ? "block" : "none";

  if(p==="hist"){
    if(!$("recapDate").value) $("recapDate").value = ymdToday();
    $("recapDate").onchange = ()=>{ buildRecap(); renderMixedHistory(); };
    buildRecap();
    loadData();
    renderPending();
    renderMixedHistory();
  }
}

/* Calcul net */
function calc(){
  const nb = Number($("nb").value);
  const brut = num($("brut").value);
  const tare = (T[$("type").value] || 0) * nb;
  const net = Math.max(0, brut - tare);
  $("net").textContent = r1(net);
}
["input","change"].forEach(ev=>{
  $("type").addEventListener(ev, calc);
  $("nb").addEventListener(ev, calc);
  $("brut").addEventListener(ev, calc);
});

/* Pending */
function getPending(){ try{ return JSON.parse(localStorage.getItem(PENDING_KEY) || "[]"); } catch{ return []; } }
function setPending(arr){
  localStorage.setItem(PENDING_KEY, JSON.stringify(arr));
  $("pendingCount").textContent = String(arr.length);
}
function addPending(row){ const arr=getPending(); arr.unshift(row); setPending(arr); }
function removePending(client_id){ setPending(getPending().filter(x=>x.client_id!==client_id)); }
function renderPending(){
  const arr=getPending();
  $("pendingCount").textContent=String(arr.length);
  const tb=$("pendingTable");
  tb.innerHTML="";
  if(!arr.length){ tb.innerHTML=`<tr><td colspan="6">Aucune ligne en attente</td></tr>`; return; }
  arr.forEach(x=>{
    tb.innerHTML += `
      <tr>
        <td>${new Date(x.local_created_at).toLocaleString()}</td>
        <td>${x.ville}</td>
        <td>${x.type}</td>
        <td class="right">${x.nb}</td>
        <td class="right">${x.net}</td>
        <td class="right"><button class="smallBtn danger" onclick="deletePending('${x.client_id}')">Suppr</button></td>
      </tr>`;
  });
}
function deletePending(client_id){
  if(!confirm("Supprimer cette ligne en attente ?")) return;
  removePending(client_id);
  renderPending();
  renderMixedHistory();
  buildRecap();
}

/* Cache */
function getHistoryCache(){ try{ return JSON.parse(localStorage.getItem(HISTORY_CACHE_KEY) || "[]"); } catch{ return []; } }
function setHistoryCache(rows, source){
  localStorage.setItem(HISTORY_CACHE_KEY, JSON.stringify(rows||[]));
  localStorage.setItem(CACHE_META_KEY, JSON.stringify({ updatedAt: Date.now(), source: source || "LIVE" }));
}
function getHistoryMeta(){ try{ return JSON.parse(localStorage.getItem(CACHE_META_KEY) || "null"); } catch{ return null; } }

/* Render (sÃ©parÃ©) */
function renderMixedHistory(){
  const pending = getPending().map(p=>({
    created_at: new Date(p.local_created_at).toISOString(),
    ville: p.ville,
    type: p.type,
    nb: p.nb,
    net: p.net,
    _source: "ATTENTE",
    _client_id: p.client_id
  }));
  const cached = getHistoryCache().map(r=>({ ...r, _source: (lastHistorySource==="LIVE"?"LIVE":"CACHE") }));
  const all = [...pending, ...cached].sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));

  const tbP = $("histPesee");
  const tbT = $("histTrie");
  if(!tbP || !tbT) return;
  tbP.innerHTML=""; tbT.innerHTML="";

  const date = ($("recapDate")?.value) || ymdToday();
  const { start, end } = dayRangeLocal(date);
  let totalTrie = 0;

  if(!all.length){
    tbP.innerHTML=`<tr><td colspan="6">Aucune donnÃ©e</td></tr>`;
    tbT.innerHTML=`<tr><td colspan="4">Aucune donnÃ©e</td></tr>`;
    $("totalTrieJour").textContent="0";
    return;
  }

  all.forEach(r=>{
    const dh = new Date(r.created_at).toLocaleString();
    const isTrie = (r.type === "PAM_TRIE");
    if(isTrie && inLocalDay(r.created_at, start, end)) totalTrie += num(r.nb);

    if(isTrie){
      tbT.innerHTML += `
        <tr>
          <td>${dh}</td>
          <td>PAM TRIÃ‰</td>
          <td class="right">${r.nb}</td>
          <td>${r._source}</td>
        </tr>`;
    }else{
      tbP.innerHTML += `
        <tr>
          <td>${dh}</td>
          <td>${r.ville}</td>
          <td>${r.type}</td>
          <td class="right">${r.nb}</td>
          <td class="right">${r.net}</td>
          <td>${r._source}</td>
        </tr>`;
    }
  });

  $("totalTrieJour").textContent = String(totalTrie);
  if(!tbT.innerHTML.trim()) tbT.innerHTML = `<tr><td colspan="4">Aucun PAM triÃ©</td></tr>`;
}

/* SYNC */
async function syncPending(){
  const arr=getPending();
  $("pendingCount").textContent=String(arr.length);
  if(!arr.length || !navigator.onLine) return;

  const { data: u } = await supabase.auth.getUser();
  if(!u?.user) return;

  const toSend=[...arr].reverse();
  for(const row of toSend){
    try{
      const payload = {
        client_id: row.client_id,
        ville: row.ville,
        type: row.type,
        nb: row.nb,
        brut: row.brut,
        tare: row.tare,
        net: row.net
      };
      const { error } = await supabase.from("pesees").upsert(payload,{ onConflict:"client_id" });
      if(error) throw error;
      removePending(row.client_id);
    }catch{ break; }
  }
  renderPending();
  await loadData();
  renderMixedHistory();
}

/* Login / logout */
async function login(){
  try{
    const email=$("email").value.trim();
    const password=$("password").value;
    if(!email || !password) return setLoginMsg("Email + mot de passe.");

    setLoginMsg("Connexionâ€¦");
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if(error) throw error;

    $("loginScreen").style.display="none";
    $("app").style.display="block";

    await loadCities();
    await loadData();
    if(!$("recapDate").value) $("recapDate").value=ymdToday();
    syncPending();
    show("pesee");
  }catch(e){
    setLoginMsg("âŒ " + (e?.message || String(e)));
  }
}
async function logout(){ await supabase.auth.signOut(); location.reload(); }
function setLoginMsg(msg){ $("loginMsg").textContent = msg || ""; }

/* Villes */
async function loadCities(){
  try{
    const { data, error } = await supabase.from("villes").select("id, nom").order("nom",{ascending:true}).limit(500);
    if(error) throw error;
    const sel=$("ville");
    sel.innerHTML="";
    (data||[]).forEach(v=>{
      const opt=document.createElement("option");
      opt.value=v.nom; opt.textContent=v.nom;
      sel.appendChild(opt);
    });
    if(!sel.options.length) sel.innerHTML="<option>â€”</option>";
  }catch{
    const sel=$("ville");
    if(sel) sel.innerHTML="<option>â€”</option>";
  }
}

/* Save pesÃ©e */
async function saveSafe(){
  try{
    calc();
    const nb=Number($("nb").value);
    const brut=num($("brut").value);
    const tare=(T[$("type").value]||0)*nb;
    const net=Math.max(0,brut-tare);
    const ville=($("ville").value||"").trim();
    const type=A[$("type").value];

    if(!ville || ville==="â€”") return alert("Choisis une ville.");
    if(brut<=0) return alert("Entre un poids brut.");
    if(brut<tare) return alert("Brut infÃ©rieur Ã  la tare.");

    const client_id="p_"+Date.now()+"_"+Math.random().toString(16).slice(2);
    const payload={ client_id, ville, type, nb, brut:r1(brut), tare:r1(tare), net:r1(net) };

    const { error } = await supabase.from("pesees").upsert(payload,{ onConflict:"client_id" });
    if(error) throw error;

    $("brut").value="";
    calc();
    await loadData();
    renderMixedHistory();
    show("pesee");
  }catch{
    const nb=Number($("nb").value);
    const brut=num($("brut").value);
    const tare=(T[$("type").value]||0)*nb;
    const net=Math.max(0,brut-tare);
    const ville=($("ville").value||"").trim();
    const type=A[$("type").value];
    const client_id="p_"+Date.now()+"_"+Math.random().toString(16).slice(2);

    addPending({ client_id, local_created_at:Date.now(), ville, type, nb, brut:r1(brut), tare:r1(tare), net:r1(net) });
    $("brut").value="";
    calc();
    renderPending();
    renderMixedHistory();
    show("pesee");
  }
}

/* Save trie (+1 / -1) */
async function saveTrie(delta){
  const d=Number(delta);
  if(!Number.isFinite(d) || d===0) return;

  try{
    const client_id="t_"+Date.now()+"_"+Math.random().toString(16).slice(2);
    const payload={ client_id, ville:"TRIE", type:"PAM_TRIE", nb:d, brut:0, tare:0, net:0 };

    const { error } = await supabase.from("pesees").upsert(payload,{ onConflict:"client_id" });
    if(error) throw error;

    await loadData();
    renderMixedHistory();
  }catch{
    const client_id="t_"+Date.now()+"_"+Math.random().toString(16).slice(2);
    addPending({ client_id, local_created_at:Date.now(), ville:"TRIE", type:"PAM_TRIE", nb:d, brut:0, tare:0, net:0 });
    renderPending();
    renderMixedHistory();
  }
}

/* loadData */
async function loadData(){
  try{
    const { data, error } = await supabase
      .from("pesees")
      .select("id, created_at, ville, type, nb, net, client_id")
      .order("created_at",{ascending:false})
      .limit(1200);
    if(error) throw error;
    lastHistorySource="LIVE";
    setHistoryCache(data||[],"LIVE");
    renderMixedHistory();
  }catch{
    lastHistorySource="CACHE";
    renderMixedHistory();
  }
}

/* recap */
function ymdToday(){
  const d=new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
}
function recapToday(){ $("recapDate").value=ymdToday(); buildRecap(); renderMixedHistory(); }
function dayRangeLocal(ymd){
  const [y,m,d]=ymd.split("-").map(Number);
  const start=new Date(y,m-1,d,0,0,0,0).getTime();
  const end=new Date(y,m-1,d+1,0,0,0,0).getTime();
  return { start, end };
}
function inLocalDay(isoOrMs,start,end){
  const t=typeof isoOrMs==="number"?isoOrMs:new Date(isoOrMs).getTime();
  return t>=start && t<end;
}
function recapFromRows(rows,pendingRows){
  const totalAll={PAM:0,ASL:0,ABJ:0,F:0,HF:0};
  const byCity={};
  const add=(ville,type,net)=>{
    const t=String(type||"").toUpperCase();
    if(!TYPES.includes(t)) return;
    const n=num(net);
    totalAll[t]+=n;
    const v=ville||"â€”";
    if(!byCity[v]) byCity[v]={PAM:0,ASL:0,ABJ:0,F:0,HF:0};
    byCity[v][t]+=n;
  };
  (rows||[]).forEach(r=>add(r.ville,r.type,r.net));
  (pendingRows||[]).forEach(p=>add(p.ville,p.type,p.net));
  return { totalAll, byCity };
}
function renderRecapTables(totalAll,byCity){
  const sumAll=TYPES.reduce((s,k)=>s+totalAll[k],0);
  $("recapAll").innerHTML=`
    <tr>
      <td class="right">${r1(totalAll.PAM)}</td>
      <td class="right">${r1(totalAll.ASL)}</td>
      <td class="right">${r1(totalAll.ABJ)}</td>
      <td class="right">${r1(totalAll.F)}</td>
      <td class="right">${r1(totalAll.HF)}</td>
      <td class="right"><b>${r1(sumAll)}</b></td>
    </tr>`;
  const villes=Object.keys(byCity).sort((a,b)=>a.localeCompare(b,"fr"));
  $("recapByCity").innerHTML = !villes.length
    ? `<tr><td colspan="7">Aucune donnÃ©e</td></tr>`
    : villes.map(v=>{
        const o=byCity[v];
        const sum=TYPES.reduce((s,k)=>s+o[k],0);
        return `
          <tr>
            <td>${v}</td>
            <td class="right">${r1(o.PAM)}</td>
            <td class="right">${r1(o.ASL)}</td>
            <td class="right">${r1(o.ABJ)}</td>
            <td class="right">${r1(o.F)}</td>
            <td class="right">${r1(o.HF)}</td>
            <td class="right"><b>${r1(sum)}</b></td>
          </tr>`;
      }).join("");
}
async function buildRecap(){
  try{
    const date=$("recapDate").value||ymdToday();
    $("recapDate").value=date;
    const [y,m,d]=date.split("-").map(Number);
    const s=new Date(y,m-1,d,0,0,0,0);
    const e=new Date(y,m-1,d+1,0,0,0,0);

    try{
      const { data, error } = await supabase
        .from("pesees")
        .select("ville,type,net,created_at")
        .gte("created_at",s.toISOString())
        .lt("created_at",e.toISOString())
        .limit(5000);
      if(error) throw error;

      const { start,end }=dayRangeLocal(date);
      const pendToday=getPending().filter(p=>inLocalDay(p.local_created_at,start,end));
      const recap=recapFromRows(data||[],pendToday);
      renderRecapTables(recap.totalAll,recap.byCity);
    }catch{
      const { start,end }=dayRangeLocal(date);
      const cache=getHistoryCache().filter(r=>inLocalDay(r.created_at,start,end));
      const pend=getPending().filter(p=>inLocalDay(p.local_created_at,start,end));
      const recap=recapFromRows(cache,pend);
      renderRecapTables(recap.totalAll,recap.byCity);
    }
  }catch{
    $("recapAll").innerHTML=`<tr><td colspan="6">Erreur</td></tr>`;
  }
}

/* Init */
(async ()=>{
  setPending(getPending());
  renderPending();
  calc();

  const meta=getHistoryMeta();
  lastHistorySource=meta?.source||"CACHE";
  renderMixedHistory();

  const { data } = await supabase.auth.getUser();
  if(data?.user){
    $("loginScreen").style.display="none";
    $("app").style.display="block";
    await loadCities();
    await loadData();
    $("recapDate").value=ymdToday();
    buildRecap();
    syncPending();
    show("pesee");
  }else{
    $("pendingCount").textContent=String(getPending().length);
  }
})();

/* Service worker */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/Pes-e/sw.js");
}
</script>
</body>
</html>