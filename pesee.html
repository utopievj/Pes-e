<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PesÃ©e</title>
  <style>
    body{font-family:system-ui;margin:0;background:#0b0c10;color:#e9eef6}
    .wrap{max-width:820px;margin:0 auto;padding:18px}
    .card{background:#12141b;border:1px solid #222634;border-radius:16px;padding:16px}
    h2{margin:0 0 8px}
    label{display:block;margin:12px 0 6px;color:#a8b3d6;font-size:12px}

    input,select{
      width:100%;padding:12px;border-radius:12px;
      border:1px solid #262b3a;background:#0f1118;color:#e9eef6;
      box-sizing:border-box
    }

    .net{margin-top:14px;padding:14px;border-radius:14px;background:#0f1118;border:1px solid #222634}
    .big{font-size:34px;font-weight:900}
    .city{margin-top:6px;color:#a8b3d6;font-size:14px}

    .grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    .col-12{grid-column:span 12}
    .col-6{grid-column:span 6}
    .col-4{grid-column:span 4}
    .col-2{grid-column:span 2}
    @media (max-width:760px){.col-6,.col-4,.col-2{grid-column:span 12}}

    /* ðŸ”´ Boutons rouges */
    button{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid #7a1f1f;
      background:#b22222;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }
    button:hover{background:#d32f2f}
    button:active{transform:scale(0.98)}

    .danger{background:#8b0000;border-color:#5c0000}

    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #222634}
    th{font-size:12px;color:#a8b3d6;background:#0f1118;position:sticky;top:0}

    .tableWrap{
      margin-top:12px;
      max-height:360px;
      overflow:auto;
      border-radius:14px;
      border:1px solid #222634
    }

    .smallBtn{
      padding:6px 10px;
      border-radius:8px;
      font-size:12px;
      width:auto;
    }
  </style>
</head>
<body>
<div class="wrap">
<div class="card">

<h2>PesÃ©e</h2>

<div class="grid">
  <div class="col-4">
    <label>Ville</label>
    <select id="ville">
      <option value="Boulanger Tarbes">Boulanger Tarbes</option>
      <option value="Pau">Pau</option>
      <option value="Envie">Envie</option>
      <option value="Assat">Assat</option>
      <option value="Coaraze">Coaraze</option>
      <option value="Espoey">Espoey</option>
    </select>
  </div>

  <div class="col-4">
    <label>Type de bac</label>
    <select id="type">
      <option value="PAM">PAM (59 kg)</option>
      <option value="ASL">ASL (45 kg)</option>
      <option value="ABJ">ABJ (43 kg)</option>
      <option value="FRIGO">Frigo (0 kg)</option>
      <option value="HORS_FROID">Hors froid (0 kg)</option>
    </select>
  </div>

  <div class="col-2">
    <label>Nombre</label>
    <select id="nb">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
  </div>

  <div class="col-2">
    <label>Poids brut (kg)</label>
    <input id="brut" type="number" min="0" step="0.1" value="0">
  </div>

  <div class="col-12">
    <div class="net">
      <div>Tare totale : <b id="tare">0</b> kg</div>
      <div class="big">Net : <span id="net">0</span> kg</div>
      <div class="city" id="villeAffichee"></div>
    </div>
  </div>

  <div class="col-6">
    <button id="save">ENREGISTRER</button>
  </div>
  <div class="col-6">
    <button id="reset">RÃ‰INITIALISER</button>
  </div>
</div>

<h3 style="margin:18px 0 8px">Historique</h3>
<button id="clearAll" class="danger">VIDER Lâ€™HISTORIQUE</button>

<div class="tableWrap">
<table>
<thead>
<tr>
  <th>Date</th>
  <th>Ville</th>
  <th>Type</th>
  <th>Nb</th>
  <th>Brut</th>
  <th>Tare</th>
  <th>Net</th>
  <th></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

</div>
</div>

<script>
(() => {
  const T = { PAM:59, ASL:45, ABJ:43, FRIGO:0, HORS_FROID:0 };
  const TYPE_AFF = { PAM:"PAM", ASL:"ASL", ABJ:"ABJ", FRIGO:"F", HORS_FROID:"HF" };
  const KEY = "pesee_history_v5";

  const $ = id => document.getElementById(id);
  const type=$("type"), nb=$("nb"), brut=$("brut"), ville=$("ville");
  const tare=$("tare"), net=$("net"), villeAff=$("villeAffichee"), tbody=$("tbody");

  const r1 = x => Math.round(x*10)/10;

  function calc(){
    const tb = T[type.value];
    const n = Number(nb.value);
    const b = Math.max(0, Number(brut.value||0));
    tare.textContent = r1(tb*n);
    net.textContent = r1(b - tb*n);
    villeAff.textContent = "Ville : " + ville.value;
  }

  function load(){ return JSON.parse(localStorage.getItem(KEY)||"[]"); }
  function save(d){ localStorage.setItem(KEY, JSON.stringify(d)); }

  function render(){
    tbody.innerHTML="";
    load().slice().reverse().forEach(e=>{
      tbody.innerHTML += `
        <tr>
          <td>${e.date}</td>
          <td>${e.ville}</td>
          <td>${TYPE_AFF[e.type]}</td>
          <td>${e.nb}</td>
          <td>${e.brut}</td>
          <td>${e.tare}</td>
          <td><b>${e.net}</b></td>
          <td><button class="smallBtn danger" data-id="${e.id}">X</button></td>
        </tr>`;
    });
  }

  $("save").onclick=()=>{
    const d=load();
    d.push({
      id:crypto.randomUUID(),
      date:new Date().toLocaleString(),
      ville:ville.value,
      type:type.value,
      nb:Number(nb.value),
      brut:r1(brut.value),
      tare:r1(T[type.value]*nb.value),
      net:r1(brut.value-T[type.value]*nb.value)
    });
    save(d); render();
  };

  $("reset").onclick=()=>{ type.value="PAM"; nb.value="1"; brut.value=0; calc(); };
  $("clearAll").onclick=()=>{ if(confirm("Tout effacer ?")){localStorage.removeItem(KEY);render();}};

  tbody.onclick=e=>{
    if(e.target.dataset.id){
      save(load().filter(x=>x.id!==e.target.dataset.id));
      render();
    }
  };

  ["input","change"].forEach(ev=>{
    type.addEventListener(ev,calc);
    nb.addEventListener(ev,calc);
    brut.addEventListener(ev,calc);
    ville.addEventListener(ev,calc);
  });

  calc(); render();
})();
</script>
</body>
</html>