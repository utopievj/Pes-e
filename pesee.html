<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Pes√©e</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:system-ui;background:#0b0c10;color:#e9eef6}
.wrap{max-width:1100px;margin:auto;padding:16px}
.card{background:#12141b;border:1px solid #222634;border-radius:16px;padding:16px}
label{display:block;margin:8px 0 4px;font-size:12px;color:#ffffff}
input,select{width:100%;padding:12px;border-radius:12px;border:1px solid #262b3a;background:#0f1118;color:#fff;box-sizing:border-box}
button{padding:14px;border-radius:12px;border:1px solid #7a1f1f;background:#b22222;color:#fff;font-weight:800;cursor:pointer}
button:hover{background:#d32f2f}
.smallBtn{padding:10px 12px;font-size:12px}
.danger{background:#8b0000;border-color:#5c0000}
.grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
.col-4{grid-column:span 4}.col-3{grid-column:span 3}.col-2{grid-column:span 2}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
@media(max-width:820px){.col-4,.col-3,.col-2,.col-6{grid-column:span 12}}
.big{font-size:34px;font-weight:900;margin:8px 0}
.badge{display:inline-block;padding:4px 10px;border:1px solid #222634;border-radius:999px;font-size:12px;color:#ffffff}
.tableWrap{overflow:auto;border:1px solid #222634;border-radius:12px;margin-top:10px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #222634}
th{font-size:12px;color:#ffffff;white-space:nowrap;text-align:left}
.right{text-align:right}
.center{min-height:90vh;display:flex;align-items:center;justify-content:center}
.max420{max-width:420px;width:100%}
#status{margin:10px 0;font-size:12px;white-space:pre-wrap;color:#ffd27a;display:block}
hr{border:0;border-top:1px solid #222634;margin:14px 0}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" class="center">
  <div class="card max420">
    <h2 style="margin-top:0">Connexion</h2>

    <label>Email</label>
    <input id="email" type="email" autocomplete="username">

    <label>Mot de passe</label>
    <input id="password" type="password" autocomplete="current-password">

    <div style="margin-top:12px;display:grid;gap:10px">
      <button onclick="login()">SE CONNECTER</button>
      <button class="danger" onclick="resetCache()">RESET CACHE (si √ßa bloque)</button>
    </div>

    <div id="loginMsg" style="margin-top:10px;font-size:12px;white-space:pre-wrap;color:#ffd27a"></div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
  <div class="wrap">
    <div class="card">

      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <button class="smallBtn" onclick="show('pesee')">PES√âE</button>
        <button class="smallBtn" onclick="show('hist')">HISTORIQUE</button>
        <button class="smallBtn" onclick="show('trie')">TRIE</button>
        <button class="smallBtn" onclick="loadAll()">üîÑ Rafra√Æchir</button>
        <button class="smallBtn" onclick="logout()">üö™ D√©connexion</button>
        <span class="badge" id="badgeUser">Connect√©</span>
        <span class="badge" id="badgeNet">R√©seau : ?</span>
        <span class="badge" id="badgeAdmin">Utilisateur</span>
      </div>

      <div id="status">Pr√™t.</div>

      <!-- PAGE PES√âE -->
      <div id="pagePesee">
        <h2>Pes√©e</h2>

        <div class="grid">
          <div class="col-4">
            <label>Ville</label>
            <select id="ville"></select>
          </div>

          <div class="col-4">
            <label>Type</label>
            <select id="type">
              <option value="PAM">PAM</option>
              <option value="ASL">ASL</option>
              <option value="ABJ">ABJ</option>
              <option value="FRIGO">FRIGO</option>
              <option value="HF">HF</option>
            </select>
          </div>

          <div class="col-2">
            <label>Nb bacs</label>
            <input id="nb" type="number" inputmode="numeric" min="1" step="1" value="1">
          </div>

          <div class="col-2">
            <label>Brut (kg)</label>
            <input id="brut" type="number" inputmode="decimal" step="0.1" placeholder="Ex: 120.5">
          </div>

          <div class="col-12">
            <div class="big">Net : <span id="net">0</span> kg</div>
          </div>

          <div class="col-12">
            <button onclick="savePesee()">ENREGISTRER</button>
          </div>
        </div>
      </div>

      <!-- PAGE HIST -->
      <div id="pageHist" style="display:none">
        <h2>Historique</h2>

        <div id="adminPanel" style="display:none">
          <hr>
          <h3>Admin</h3>
          <button class="danger" onclick="clearAll()">üßπ Vider TOUT (pes√©es + trie)</button>
          <p style="font-size:12px;color:#ffd27a;margin:8px 0 0">‚ö†Ô∏è irr√©versible</p>
        </div>

        <hr>

        <h3>Pes√©es</h3>
        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Date</th><th>Ville</th><th>Type</th>
                <th class="right">Nb</th><th class="right">Net</th>
                <th>Op√©rateur</th>
              </tr>
            </thead>
            <tbody id="histPesee"></tbody>
          </table>
        </div>

        <hr>

        <h2>Trie (r√©sum√©)</h2>

        <h3>PAM tri√© ‚Äî Total par jour</h3>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Jour</th><th class="right">Total</th></tr></thead>
            <tbody id="pamTrieTotalsHist"></tbody>
          </table>
        </div>

        <h3>ASL tri√© ‚Äî Total par jour</h3>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Jour</th><th class="right">Total</th></tr></thead>
            <tbody id="aslTrieTotalsHist"></tbody>
          </table>
        </div>

        <h3>Trie en KG ‚Äî Total par jour</h3>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Jour</th><th>Cat√©gorie</th><th class="right">Total (kg)</th></tr></thead>
            <tbody id="kgTrieTotalsHist"></tbody>
          </table>
        </div>
      </div>

      <!-- PAGE TRIE -->
      <div id="pageTrie" style="display:none">
        <h2>Trie</h2>

        <h3>PAM tri√©</h3>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <button onclick="addPamTrie(+1)">+1</button>
          <button class="danger" onclick="addPamTrie(-1)">-1</button>
        </div>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Jour</th><th class="right">Total</th></tr></thead>
            <tbody id="pamTrieTotals"></tbody>
          </table>
        </div>

        <hr>

        <h3>ASL tri√©</h3>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <button onclick="addAslTrie(+1)">+1</button>
          <button class="danger" onclick="addAslTrie(-1)">-1</button>
        </div>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Jour</th><th class="right">Total</th></tr></thead>
            <tbody id="aslTrieTotals"></tbody>
          </table>
        </div>

        <hr>

        <h3>Trie en KG (avec tare ABJ/ASL)</h3>
        <div class="grid">
          <div class="col-6">
            <label>Cat√©gorie</label>
            <select id="kgCat">
              <option value="Plastique dur">Plastique dur</option>
              <option value="Plastique mou">Plastique mou</option>
              <option value="ASL autre">ASL autre</option>
              <option value="N-DIB">N-DIB</option>
              <option value="NREP Ecomaison">NREP Ecomaison</option>
              <option value="NREP Refashion">NREP Refashion</option>
            </select>
          </div>
          <div class="col-3">
            <label>Bac</label>
            <select id="kgBac">
              <option value="ASL">ASL (45kg)</option>
              <option value="ABJ">ABJ (43kg)</option>
            </select>
          </div>
          <div class="col-3">
            <label>Nb bacs</label>
            <input id="kgNb" type="number" inputmode="numeric" min="1" step="1" value="1">
          </div>
          <div class="col-6">
            <label>Brut (kg)</label>
            <input id="kgBrut" type="number" inputmode="decimal" step="0.1" placeholder="Ex: 120.5">
          </div>
          <div class="col-6" style="display:flex;align-items:end">
            <button onclick="saveKgTrie()">ENREGISTRER TRI KG</button>
          </div>
        </div>

        <h3 style="margin-top:14px">Totaux par jour (KG)</h3>
        <div class="tableWrap">
          <table>
            <thead><tr><th>Jour</th><th>Cat√©gorie</th><th class="right">Total (kg)</th></tr></thead>
            <tbody id="kgTrieTotals"></tbody>
          </table>
        </div>

      </div>

    </div>
  </div>
</div>

<script>
/* ========= CONFIG SUPABASE ========= */
const SUPABASE_URL = "https://dzfokswsmkvhjhziqakj.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6Zm9rc3dzbWt2aGpoemlxYWtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTQ5MTAsImV4cCI6MjA4MTM5MDkxMH0.dVdAUGstXPPSAeDQwX-Paha2s86rebaSwnsk6hFYpq0";

/* ========= ADMIN ========= */
const ADMIN_EMAILS = ["boyrieanthony2@gmail.com"];

/* ========= HELPERS ========= */
const $ = (id)=>document.getElementById(id);
const r1 = (x)=>Math.round(x*10)/10;
const num = (x)=>{ const v=Number(String(x).replace(",", ".")); return Number.isFinite(v)?v:0; };
function setStatus(msg){ $("status").textContent = msg || ""; }
function setLoginMsg(msg){ $("loginMsg").textContent = msg || ""; }
function refreshNetwork(){ $("badgeNet").textContent = "R√©seau : " + (navigator.onLine ? "OK" : "HORS-LIGNE"); }

/* SDK check */
document.addEventListener("DOMContentLoaded", ()=>{
  refreshNetwork();
  if(!window.supabase){
    setLoginMsg("‚ùå Supabase SDK non charg√©.\nV√©rifie r√©seau / DNS / bloqueur.\nPuis recharge.");
  }
});

const supabase = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* TARES */
const T = { PAM:59, ASL:45, ABJ:43, FRIGO:0, HF:0 };

let currentUser = null;
let isAdminUser = false;

/* Pages */
function show(p){
  $("pagePesee").style.display = (p==="pesee") ? "block" : "none";
  $("pageHist").style.display  = (p==="hist")  ? "block" : "none";
  $("pageTrie").style.display  = (p==="trie")  ? "block" : "none";
  if(p==="hist" || p==="trie") loadAll();
}

/* Calc net pes√©e */
function calcPesee(){
  const nb = Math.max(1, Math.floor(num($("nb").value || 1)));
  $("nb").value = String(nb);
  const brut = num($("brut").value);
  const tare = (T[$("type").value] || 0) * nb;
  const net = Math.max(0, brut - tare);
  $("net").textContent = r1(net);
}
["input","change"].forEach(ev=>{
  $("type").addEventListener(ev, calcPesee);
  $("nb").addEventListener(ev, calcPesee);
  $("brut").addEventListener(ev, calcPesee);
});
/* ========= AUTH ========= */
async function login(){
  try{
    if(!supabase) return setLoginMsg("‚ùå Supabase non pr√™t (SDK).");
    const email = $("email").value.trim();
    const password = $("password").value;
    if(!email || !password) return setLoginMsg("Email + mot de passe.");

    setLoginMsg("Connexion‚Ä¶");
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if(error) throw error;

    const { data } = await supabase.auth.getUser();
    currentUser = data?.user || null;

    isAdminUser = !!currentUser?.email && ADMIN_EMAILS.includes(currentUser.email.toLowerCase());
    $("badgeAdmin").textContent = isAdminUser ? "ADMIN" : "Utilisateur";
    $("adminPanel").style.display = isAdminUser ? "block" : "none";

    $("badgeUser").textContent = currentUser?.email ? ("Connect√© : " + currentUser.email) : "Connect√©";
    $("loginScreen").style.display = "none";
    $("app").style.display = "block";

    setLoginMsg("");
    setStatus("‚úÖ Connect√©");
    refreshNetwork();

    await loadCities();
    await loadAll();
    show("pesee");
  }catch(e){
    setLoginMsg("‚ùå " + (e?.message || String(e)));
  }
}

async function logout(){
  try{
    if(!supabase) return location.reload();
    await supabase.auth.signOut();
    location.reload();
  }catch(e){
    setStatus("‚ùå " + (e?.message || String(e)));
  }
}

/* Reset cache (localStorage uniquement) */
function resetCache(){
  try{
    localStorage.clear();
    setLoginMsg("‚úÖ Cache local supprim√©. Recharge la page.");
  }catch(e){
    setLoginMsg("‚ùå Reset: " + (e?.message || String(e)));
  }
}

/* ========= CITIES ========= */
async function loadCities(){
  try{
    const { data, error } = await supabase.from("villes").select("id, nom").order("nom",{ascending:true}).limit(500);
    if(error) throw error;
    const sel = $("ville");
    sel.innerHTML = "";
    (data||[]).forEach(v=>{
      const opt=document.createElement("option");
      opt.value=v.nom; opt.textContent=v.nom;
      sel.appendChild(opt);
    });
    if(!sel.options.length) sel.innerHTML="<option>‚Äî</option>";
  }catch(e){
    setStatus("‚ö†Ô∏è Villes: " + (e?.message || String(e)));
  }
}

/* ========= PES√âE ========= */
async function savePesee(){
  try{
    if(!currentUser) return alert("Connecte-toi.");
    calcPesee();

    const nb = Math.max(1, Math.floor(num($("nb").value || 1)));
    const brut = num($("brut").value);
    const tare = (T[$("type").value] || 0) * nb;
    const net  = Math.max(0, brut - tare);
    const ville = ($("ville").value || "").trim();
    const type = $("type").value;

    if(!ville || ville==="‚Äî") return alert("Choisis une ville.");
    if(brut<=0) return alert("Entre un brut.");
    if(brut<tare) return alert("Brut inf√©rieur √† la tare.");

    const ok = confirm(
      "Confirmer ?\n\n"+
      "Ville: "+ville+"\n"+
      "Type: "+type+" | Nb: "+nb+"\n"+
      "Brut: "+r1(brut)+" kg\n"+
      "Tare: "+r1(tare)+" kg\n"+
      "NET:  "+r1(net)+" kg"
    );
    if(!ok) return;

    setStatus("Insertion‚Ä¶");

    const payload = {
      ville, type,
      nb,
      brut: r1(brut),
      tare: r1(tare),
      net:  r1(net),
      operator: currentUser.email
    };

    const { error } = await supabase.from("pesees").insert(payload);
    if(error) throw error;

    $("brut").value="";
    calcPesee();

    setStatus("‚úÖ Enregistr√©");
    await loadHistPesee();
    show("pesee");
  }catch(e){
    setStatus("‚ùå " + (e?.message || String(e)));
    alert("Erreur: " + (e?.message || String(e)));
  }
}

/* ========= HIST PES√âE ========= */
async function loadHistPesee(){
  try{
    const { data, error } = await supabase
      .from("pesees")
      .select("id, created_at, ville, type, nb, net, operator")
      .order("created_at",{ascending:false})
      .limit(1500);
    if(error) throw error;

    const tb = $("histPesee");
    tb.innerHTML = "";

    if(!(data||[]).length){
      tb.innerHTML = `<tr><td colspan="6">Aucune donn√©e</td></tr>`;
      return;
    }

    (data||[]).forEach(r=>{
      tb.innerHTML += `
        <tr>
          <td>${new Date(r.created_at).toLocaleString()}</td>
          <td>${r.ville||"‚Äî"}</td>
          <td>${r.type||"‚Äî"}</td>
          <td class="right">${r.nb||0}</td>
          <td class="right">${r.net||0}</td>
          <td>${r.operator||"‚Äî"}</td>
        </tr>`;
    });
  }catch(e){
    setStatus("‚ö†Ô∏è Historique: " + (e?.message || String(e)));
  }
}

/* ========= TRIE PAM / ASL (+1/-1) ========= */
async function addPamTrie(delta){
  try{
    if(!currentUser) return alert("Connecte-toi.");
    if(delta!==1 && delta!==-1) return;
    const { error } = await supabase.from("pam_trie").insert({ delta, operator: currentUser.email });
    if(error) throw error;
    await loadPamTrieTotals();
  }catch(e){
    setStatus("‚ùå PAM tri√©: " + (e?.message || String(e)));
  }
}

async function addAslTrie(delta){
  try{
    if(!currentUser) return alert("Connecte-toi.");
    if(delta!==1 && delta!==-1) return;
    const { error } = await supabase.from("asl_trie").insert({ delta, operator: currentUser.email });
    if(error) throw error;
    await loadAslTrieTotals();
  }catch(e){
    setStatus("‚ùå ASL tri√©: " + (e?.message || String(e)));
  }
}

function ymdFromISO(iso){
  const d=new Date(iso);
  const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,"0");
  const da=String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${da}`;
}

async function loadPamTrieTotals(){
  const { data, error } = await supabase
    .from("pam_trie")
    .select("created_at, delta")
    .order("created_at",{ascending:false})
    .limit(5000);
  if(error) throw error;

  const totals={};
  (data||[]).forEach(r=>{
    const day=ymdFromISO(r.created_at);
    totals[day]=(totals[day]||0)+(Number(r.delta)||0);
  });

  const rows=Object.keys(totals).sort((a,b)=>b.localeCompare(a)).map(day=>({day,total:totals[day]}));

  const t1=$("pamTrieTotals"); const t2=$("pamTrieTotalsHist");
  const html = rows.length
    ? rows.map(r=>`<tr><td>${r.day}</td><td class="right"><b>${r.total}</b></td></tr>`).join("")
    : `<tr><td colspan="2">Aucune donn√©e</td></tr>`;
  t1.innerHTML = html;
  t2.innerHTML = html;
}

async function loadAslTrieTotals(){
  const { data, error } = await supabase
    .from("asl_trie")
    .select("created_at, delta")
    .order("created_at",{ascending:false})
    .limit(5000);
  if(error) throw error;

  const totals={};
  (data||[]).forEach(r=>{
    const day=ymdFromISO(r.created_at);
    totals[day]=(totals[day]||0)+(Number(r.delta)||0);
  });

  const rows=Object.keys(totals).sort((a,b)=>b.localeCompare(a)).map(day=>({day,total:totals[day]}));

  const t1=$("aslTrieTotals"); const t2=$("aslTrieTotalsHist");
  const html = rows.length
    ? rows.map(r=>`<tr><td>${r.day}</td><td class="right"><b>${r.total}</b></td></tr>`).join("")
    : `<tr><td colspan="2">Aucune donn√©e</td></tr>`;
  t1.innerHTML = html;
  t2.innerHTML = html;
}
/* ========= TRIE KG ========= */
function tareKgFromBac(bac){
  if(bac==="ASL") return 45;
  if(bac==="ABJ") return 43;
  return 0;
}

async function saveKgTrie(){
  try{
    if(!currentUser) return alert("Connecte-toi.");

    const cat = ($("kgCat").value || "").trim();
    const bac = ($("kgBac").value || "").trim();
    const nb  = Math.max(1, Math.floor(num($("kgNb").value || 1)));
    $("kgNb").value = String(nb);

    const brut = num($("kgBrut").value);
    const tareUnit = tareKgFromBac(bac);
    const tare = tareUnit * nb;
    const net = Math.max(0, brut - tare);

    if(!cat) return alert("Choisis une cat√©gorie.");
    if(brut<=0) return alert("Entre un brut.");
    if(brut<tare) return alert("Brut inf√©rieur √† la tare.");

    const ok = confirm(
      "Confirmer TRI KG ?\n\n"+
      "Cat√©gorie: "+cat+"\n"+
      "Bac: "+bac+" | Nb: "+nb+"\n"+
      "Brut: "+r1(brut)+" kg\n"+
      "Tare: "+r1(tare)+" kg\n"+
      "NET:  "+r1(net)+" kg"
    );
    if(!ok) return;

    setStatus("Insertion TRI KG‚Ä¶");

    const payload = {
      category: cat,
      bac_type: bac,
      nb_bacs: nb,
      brut: r1(brut),
      tare: r1(tare),
      net: r1(net),
      operator: currentUser.email
    };

    const { error } = await supabase.from("tri_kg").insert(payload);
    if(error) throw error;

    $("kgBrut").value="";
    setStatus("‚úÖ TRI KG enregistr√©");
    await loadKgTrieTotals();
  }catch(e){
    setStatus("‚ùå TRI KG: " + (e?.message || String(e)));
    alert("Erreur: " + (e?.message || String(e)));
  }
}

async function loadKgTrieTotals(){
  const { data, error } = await supabase
    .from("tri_kg")
    .select("created_at, category, net")
    .order("created_at",{ascending:false})
    .limit(8000);
  if(error) throw error;

  // totals[day][cat] = sum(net)
  const totals = {};
  (data||[]).forEach(r=>{
    const day = ymdFromISO(r.created_at);
    const cat = r.category || "‚Äî";
    if(!totals[day]) totals[day]={};
    totals[day][cat] = (totals[day][cat]||0) + (Number(r.net)||0);
  });

  const days = Object.keys(totals).sort((a,b)=>b.localeCompare(a));
  const rows = [];
  days.forEach(day=>{
    Object.keys(totals[day]).sort((a,b)=>a.localeCompare(b,"fr")).forEach(cat=>{
      rows.push({ day, cat, total: totals[day][cat] });
    });
  });

  const html = rows.length
    ? rows.map(r=>`<tr><td>${r.day}</td><td>${r.cat}</td><td class="right"><b>${r1(r.total)}</b></td></tr>`).join("")
    : `<tr><td colspan="3">Aucune donn√©e</td></tr>`;

  $("kgTrieTotals").innerHTML = html;
  $("kgTrieTotalsHist").innerHTML = html;
}

/* ========= ADMIN CLEAR ALL ========= */
async function clearAll(){
  if(!isAdminUser) return alert("Admin uniquement.");
  if(!confirm("‚ö†Ô∏è Vider TOUT (pes√©es + trie) ?")) return;

  try{
    setStatus("Suppression totale‚Ä¶");

    // supprimer toutes les tables
    let r;

    r = await supabase.from("pesees").delete().neq("id", -1);
    if(r.error) throw r.error;

    r = await supabase.from("pam_trie").delete().neq("id", -1);
    if(r.error) throw r.error;

    r = await supabase.from("asl_trie").delete().neq("id", -1);
    if(r.error) throw r.error;

    r = await supabase.from("tri_kg").delete().neq("id", -1);
    if(r.error) throw r.error;

    setStatus("‚úÖ Tout vid√©");
    await loadAll();
  }catch(e){
    setStatus("‚ùå ClearAll: " + (e?.message || String(e)));
    alert("Erreur clear: " + (e?.message || String(e)));
  }
}

/* ========= LOAD ALL ========= */
async function loadAll(){
  try{
    if(!currentUser) return;
    refreshNetwork();
    await loadHistPesee();
    await loadPamTrieTotals();
    await loadAslTrieTotals();
    await loadKgTrieTotals();
    setStatus("Pr√™t.");
  }catch(e){
    setStatus("‚ö†Ô∏è LoadAll: " + (e?.message || String(e)));
  }
}

/* ========= INIT ========= */
(async ()=>{
  refreshNetwork();
  calcPesee();

  if(!supabase) return;

  const { data } = await supabase.auth.getUser();
  if(data?.user){
    currentUser = data.user;
    isAdminUser = !!currentUser?.email && ADMIN_EMAILS.includes(currentUser.email.toLowerCase());
    $("badgeAdmin").textContent = isAdminUser ? "ADMIN" : "Utilisateur";
    $("adminPanel").style.display = isAdminUser ? "block" : "none";

    $("badgeUser").textContent = currentUser?.email ? ("Connect√© : " + currentUser.email) : "Connect√©";
    $("loginScreen").style.display = "none";
    $("app").style.display = "block";

    await loadCities();
    await loadAll();
    show("pesee");
  }
})();
</script>
</body>
</html>